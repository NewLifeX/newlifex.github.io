<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NewLife.Redis 100亿数据使用经验技巧分享 | 新生命开发团队文档中心</title>
    <meta name="description" content="新生命团队基础框架X组件，包括日志、数据库、网络、RPC、序列化、缓存、Windows服务、多线程等模块，支持.Net Framework/.netstandard/Mono">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3ab1ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/logo.jpg">
  <meta name="msapplication-TileImage" content="/logo.jpg">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.de611d4e.css" as="style"><link rel="preload" href="/assets/js/app.9330de40.js" as="script"><link rel="preload" href="/assets/js/19.3ecaab5f.js" as="script"><link rel="prefetch" href="/assets/js/10.35759869.js"><link rel="prefetch" href="/assets/js/11.b9b77a79.js"><link rel="prefetch" href="/assets/js/12.6fc717c7.js"><link rel="prefetch" href="/assets/js/13.a4b917f3.js"><link rel="prefetch" href="/assets/js/14.6604a2e0.js"><link rel="prefetch" href="/assets/js/15.400c29f0.js"><link rel="prefetch" href="/assets/js/16.301b2ed2.js"><link rel="prefetch" href="/assets/js/17.27d61f12.js"><link rel="prefetch" href="/assets/js/18.e60c95c8.js"><link rel="prefetch" href="/assets/js/2.10eb8ddc.js"><link rel="prefetch" href="/assets/js/20.32dc8d2c.js"><link rel="prefetch" href="/assets/js/21.33f8edcb.js"><link rel="prefetch" href="/assets/js/22.471df735.js"><link rel="prefetch" href="/assets/js/23.487894d2.js"><link rel="prefetch" href="/assets/js/24.bf42f7e1.js"><link rel="prefetch" href="/assets/js/25.04e7e860.js"><link rel="prefetch" href="/assets/js/26.a5203d29.js"><link rel="prefetch" href="/assets/js/27.3d880fa3.js"><link rel="prefetch" href="/assets/js/28.7d0ed8f6.js"><link rel="prefetch" href="/assets/js/29.29df219a.js"><link rel="prefetch" href="/assets/js/3.8cbb110b.js"><link rel="prefetch" href="/assets/js/30.e0293d41.js"><link rel="prefetch" href="/assets/js/31.485fdbd9.js"><link rel="prefetch" href="/assets/js/32.96dc34c6.js"><link rel="prefetch" href="/assets/js/33.12ae9c72.js"><link rel="prefetch" href="/assets/js/34.1b5cb9b8.js"><link rel="prefetch" href="/assets/js/35.c328120e.js"><link rel="prefetch" href="/assets/js/36.2475e536.js"><link rel="prefetch" href="/assets/js/37.983f8195.js"><link rel="prefetch" href="/assets/js/38.95b05225.js"><link rel="prefetch" href="/assets/js/39.71750b32.js"><link rel="prefetch" href="/assets/js/4.099314e7.js"><link rel="prefetch" href="/assets/js/40.b9deb63d.js"><link rel="prefetch" href="/assets/js/41.1f2475d1.js"><link rel="prefetch" href="/assets/js/5.f7bd1975.js"><link rel="prefetch" href="/assets/js/6.29572d09.js"><link rel="prefetch" href="/assets/js/7.04a76e2b.js"><link rel="prefetch" href="/assets/js/8.92fe5e48.js"><link rel="prefetch" href="/assets/js/9.38f7529b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.de611d4e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">新生命开发团队文档中心</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">XCode</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/XCode/" class="nav-link">XCode</a></li><li class="dropdown-item"><!----> <a href="/XCode/fundamentals/" class="nav-link">基础知识</a></li><li class="dropdown-item"><!----> <a href="/XCode/modeling/" class="nav-link">模型</a></li><li class="dropdown-item"><!----> <a href="/XCode/querying/" class="nav-link">查询</a></li></ul></div></div><div class="nav-item"><a href="/team/" class="nav-link">团队</a></div><div class="nav-item"><a href="/DotNetCore/" class="nav-link">DotNetCore</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">魔方</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cube/" class="nav-link">FX版</a></li><li class="dropdown-item"><!----> <a href="/CubeCore/" class="nav-link">Core版</a></li></ul></div></div><div class="nav-item"><a href="/Net/" class="nav-link">网络库</a></div><div class="nav-item"><a href="/Redis/" class="nav-link router-link-exact-active router-link-active">Redis</a></div><div class="nav-item"><a href="/training/" class="nav-link">培训</a></div> <a href="https://github.com/NewLifeX/XDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">XCode</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/XCode/" class="nav-link">XCode</a></li><li class="dropdown-item"><!----> <a href="/XCode/fundamentals/" class="nav-link">基础知识</a></li><li class="dropdown-item"><!----> <a href="/XCode/modeling/" class="nav-link">模型</a></li><li class="dropdown-item"><!----> <a href="/XCode/querying/" class="nav-link">查询</a></li></ul></div></div><div class="nav-item"><a href="/team/" class="nav-link">团队</a></div><div class="nav-item"><a href="/DotNetCore/" class="nav-link">DotNetCore</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">魔方</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Cube/" class="nav-link">FX版</a></li><li class="dropdown-item"><!----> <a href="/CubeCore/" class="nav-link">Core版</a></li></ul></div></div><div class="nav-item"><a href="/Net/" class="nav-link">网络库</a></div><div class="nav-item"><a href="/Redis/" class="nav-link router-link-exact-active router-link-active">Redis</a></div><div class="nav-item"><a href="/training/" class="nav-link">培训</a></div> <a href="https://github.com/NewLifeX/XDoc" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="newlife-redis-100亿数据使用经验技巧分享"><a href="#newlife-redis-100亿数据使用经验技巧分享" aria-hidden="true" class="header-anchor">#</a> NewLife.Redis 100亿数据使用经验技巧分享</h1> <ul><li>本文包括Redis入门，基础知识，NewLife.Redis使用，Redis使用技巧，100亿小数据使用经验技巧分享</li></ul> <h2 id="介绍"><a href="#介绍" aria-hidden="true" class="header-anchor">#</a> 介绍</h2> <ul><li>NewLife.Redis主要作者及经验介绍来源：<a href="https://www.cnblogs.com/nnhy/" target="_blank" rel="noopener noreferrer">大石头<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>源码： https://github.com/NewLifeX/NewLife.Redis</li> <li>Nuget：NewLife.Redis</li> <li>NewLife.Redis是一个Redis客户端组件，以高性能处理大数据实时计算为目标。</li> <li>Redis协议基础实现Redis/RedisClient位于<a href="https://github.com/NewLifeX/X/blob/master/NewLife.Core/Caching/Redis.cs" target="_blank" rel="noopener noreferrer">X组件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，包含基础字符串操作。完整实现由独立开源项目<a href="https://github.com/NewLifeX/NewLife.Redis" target="_blank" rel="noopener noreferrer">NewLife.Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>提供。<code>NewLife.Redis</code>为扩展实现，主要增加列表结构、哈希结构、队列等高级功能。</li> <li>采取连接池加同步阻塞架构，具有超低延迟（200~600us）以及超高吞吐量的特点。在物流行业大数据实时计算中广泛应有，经过日均100亿次调用量验证。</li></ul> <h2 id="特性"><a href="#特性" aria-hidden="true" class="header-anchor">#</a> 特性</h2> <ul><li>在ZTO大数据实时计算广泛应用，200多个Redis实例稳定工作一年多，每天处理近1亿包裹数据，日均调用量80亿次</li> <li>低延迟，Get/Set操作平均耗时200~600us（含往返网络通信）</li> <li>大吞吐，自带连接池，最大支持1000并发</li> <li>高性能，支持二进制序列化</li></ul> <h2 id="基础知识准备"><a href="#基础知识准备" aria-hidden="true" class="header-anchor">#</a> 基础知识准备</h2> <h3 id="相关资源地址"><a href="#相关资源地址" aria-hidden="true" class="header-anchor">#</a> 相关资源地址</h3> <ul><li><a href="http://www.redis.cn" target="_blank" rel="noopener noreferrer">国内地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，<a href="https://redis.io/" target="_blank" rel="noopener noreferrer">国外地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.redis.cn/articles.html" target="_blank" rel="noopener noreferrer">Redis相关文章列表<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener noreferrer">Redis命令大全<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.redis.cn/topics/faq.html" target="_blank" rel="noopener noreferrer">Redis FAQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/antirez/redis-doc/" target="_blank" rel="noopener noreferrer">文档项目地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（建议看原版）</li> <li>Redis安装包：
<ul><li>项目用到的包： http://x.newlifex.com/Redis-x64-3.2.100.msi</li> <li>win安装包：https://github.com/MicrosoftArchive/redis/releases</li> <li>源码包：http://www.redis.cn/download.html</li></ul></li></ul> <h3 id="redis介绍"><a href="#redis介绍" aria-hidden="true" class="header-anchor">#</a> Redis介绍</h3> <ul><li>Redis的意思是<strong>RE</strong>mote <strong>DI</strong>ctionary <strong>S</strong>erver，远程字典服务。</li> <li>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。</li> <li>Redis与其他Key-Value存储有何不同
<ul><li>Redis有着更为复杂的数据结构并且提供对他们的原子性操作，这是一个不同于其他数据库的进化路径。Redis的数据类型都是基于基本数据结构的同时对程序员透明，无需进行额外的抽象。</li> <li>Redis运行在内存中但是可以持久化到磁盘，所以在对不同数据集进行高速读写时需要权衡内存，应为数据量不能大于硬件内存。在内存数据库方面的另一个优点是， 相比在磁盘上相同的复杂的数据结构，在内存中操作起来非常简单，这样Redis可以做很多内部复杂性很强的事情。 同时，在磁盘格式方面他们是紧凑的以追加的方式产生的，因为他们并不需要进行随机访问。</li></ul></li> <li>Redis其实很简单，最主要的操作是<code>Get</code>和<code>Set</code>，操作的数据就是<code>Key-Value</code>键值对，键为字符串，值是基础数据类型、复杂数据类型</li></ul> <h3 id="数据类型"><a href="#数据类型" aria-hidden="true" class="header-anchor">#</a> 数据类型</h3> <ul><li><a href="https://github.com/antirez/redis-doc/blob/master/topics/data-types.md" target="_blank" rel="noopener noreferrer">类型介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/antirez/redis-doc/blob/master/topics/data-types-intro.md" target="_blank" rel="noopener noreferrer">详细介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="字符串（strings）"><a href="#字符串（strings）" aria-hidden="true" class="header-anchor">#</a> 字符串（Strings）</h4> <ul><li>字符串是一种最基本的Redis值类型。</li></ul> <h4 id="列表（lists）"><a href="#列表（lists）" aria-hidden="true" class="header-anchor">#</a> 列表（Lists）</h4> <ul><li>Redis列表是简单的字符串列表，按照插入顺序排序。</li></ul> <h4 id="集合（sets）"><a href="#集合（sets）" aria-hidden="true" class="header-anchor">#</a> 集合（Sets）</h4> <ul><li>Redis集合是一个无序的字符串合集。</li></ul> <h4 id="哈希（hashes）"><a href="#哈希（hashes）" aria-hidden="true" class="header-anchor">#</a> 哈希（Hashes）</h4> <ul><li>Redis Hashes是字符串字段和字符串值之间的映射，因此它们是表示对象的完美数据类型（例如，具有多个字段的用户，如姓名，姓氏，年龄等）。</li></ul> <h4 id="有序集合（sorted-sets）"><a href="#有序集合（sorted-sets）" aria-hidden="true" class="header-anchor">#</a> 有序集合（Sorted sets）</h4> <ul><li>Redis有序集合和Redis集合类似，是非重复的字符串集合。不同之处在于，排序集的每个成员都与得分相关联，用于从最小得分到最高得分排序。虽然成员是独一无二的，但可以重复分数。</li></ul> <h4 id="其它类型"><a href="#其它类型" aria-hidden="true" class="header-anchor">#</a> 其它类型</h4> <ul><li><a href="https://github.com/antirez/redis-doc/blob/master/topics/data-types-intro.md" target="_blank" rel="noopener noreferrer">戳这里查看更多类型<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="命令"><a href="#命令" aria-hidden="true" class="header-anchor">#</a> 命令</h3> <ul><li>命令大全，方便查询： http://www.redis.cn/commands/</li> <li>向Redis服务端发送命令，对数据进行操作，客户端只需要发送命令，接收结果</li></ul> <h4 id="设置-set"><a href="#设置-set" aria-hidden="true" class="header-anchor">#</a> 设置 SET</h4> <ul><li><code>SET key value [EX seconds] [PX milliseconds] [NX|XX]</code> <ul><li>EX seconds – 设置键key的过期时间，单位时秒</li> <li>PX milliseconds – 设置键key的过期时间，单位时毫秒</li> <li>NX – 只有键key不存在的时候才会设置key的值</li> <li>XX – 只有键key存在的时候才会设置key的值</li></ul></li></ul> <h4 id="获取-get"><a href="#获取-get" aria-hidden="true" class="header-anchor">#</a> 获取 GET</h4> <ul><li><code>GET key</code></li></ul> <h4 id="删除-del"><a href="#删除-del" aria-hidden="true" class="header-anchor">#</a> 删除 DEL</h4> <ul><li><code>DEL key [key ...]</code></li></ul> <h4 id="搜索-keys"><a href="#搜索-keys" aria-hidden="true" class="header-anchor">#</a> 搜索 KEYS</h4> <ul><li><code>KEYS pattern</code></li></ul> <h2 id="newlife-redis"><a href="#newlife-redis" aria-hidden="true" class="header-anchor">#</a> NewLife.Redis</h2> <ul><li>有了以上知识，那么你就可以很容易地理解NewLife.Redis了</li> <li>NewLife.Redis实际上就是实现了常用数据类型，发送命令给Redis服务端对数据进行操作</li></ul> <h3 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h3> <ul><li><a href="http://x.newlifex.com/Redis-x64-3.2.100.msi" target="_blank" rel="noopener noreferrer">下载安装<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，默认为6379</li></ul> <blockquote><p>一般安装实例在服务器，建议端口号从6001开始，一路排下去，方便计数。</p></blockquote> <ul><li>安装完打开命令行窗口，输入<code>redis-cli</code>回车，即可进入redis环境，输入命令可进行Redis操作，如果输入正确的命令，它会自动出现提示，空格后输入下一个参数即可</li></ul> <div class="language-powershell extra-class"><pre class="language-powershell"><code><span class="token function">PS</span> C:\Users\12504&gt; redis<span class="token operator">-</span><span class="token function">cli</span>
127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:6379&gt; KEYS <span class="token operator">*</span>
<span class="token punctuation">(</span>empty list or <span class="token function">set</span><span class="token punctuation">)</span>
127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:6379&gt; KEYS <span class="token operator">*</span>
<span class="token punctuation">(</span>empty list or <span class="token function">set</span><span class="token punctuation">)</span>
127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1:6379&gt;
</code></pre></div><h3 id="连接"><a href="#连接" aria-hidden="true" class="header-anchor">#</a> 连接</h3> <ul><li>连接Redis可以设置密码，有两种写法，可以不用密码和端口</li> <li>第二个参数是数据库，0-15号，共16个，不写默认是0号</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 实例化Redis，默认端口6379可以省略，密码有两种写法</span>
<span class="token keyword">var</span> ic1 <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ic2 <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;pass@127.0.0.1:6379&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ic3 <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;server=127.0.0.1:6379;password=pass&quot;</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ic1<span class="token punctuation">.</span>Log <span class="token operator">=</span> XTrace<span class="token punctuation">.</span>Log<span class="token punctuation">;</span> <span class="token comment">// 调试日志。正式使用时注释掉</span>
</code></pre></div><h3 id="基础操作"><a href="#基础操作" aria-hidden="true" class="header-anchor">#</a> 基础操作</h3> <ul><li>使用之前，进行注册，将FullRedis注册到对象容器，此对象容器2010年就已经存在了。不注册将使用基础Redis，无法使用高级功能</li> <li>查看说明：使用了日志输出，<code>=&gt;</code>代表执行结果，<code>=&gt;</code>的上一行代表发送到Redis执行的命令。所有时间开头、数字、字母，比如<code>22:32:33.354 1 N - 为NewLife.Caching.Redis自动注册</code>这种格式都是X组件的日志输出格式。</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 激活FullRedis，否则Redis.Create会得到默认的Redis对象</span>
FullRedis<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>集合操作的 <code>GetList/GetDictionary/GetQueue/GetSet</code> 四个类型集合，分别代表Redis的列表、哈希、队列、Set集合等。基础版Redis不支持这四个集合，完整版<a href="https://github.com/NewLifeX/NewLife.Redis" target="_blank" rel="noopener noreferrer">NewLife.Redis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>支持，MemoryCache则直接支持。</li></ul> <h4 id="简单操作"><a href="#简单操作" aria-hidden="true" class="header-anchor">#</a> 简单操作</h4> <p>执行</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>XTrace<span class="token punctuation">.</span><span class="token function">UseConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将操作日志重定向到控制台</span>

<span class="token comment">// 激活FullRedis，否则Redis.Create会得到默认的Redis对象</span>
FullRedis<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> ic <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:6379&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ic<span class="token punctuation">.</span>Log <span class="token operator">=</span> XTrace<span class="token punctuation">.</span>Log<span class="token punctuation">;</span>

<span class="token comment">// 简单操作</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;共有缓存对象 {0} 个&quot;</span><span class="token punctuation">,</span> ic<span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>

ic<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;大石头&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ic<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">DateTime</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Thread<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">1100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">DateTime</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.354</span>  <span class="token number">1</span> N <span class="token operator">-</span> 为NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>Redis自动注册<span class="token class-name">NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>FullRedis</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.441</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SELECT</span> <span class="token number">3</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.444</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token class-name">OK</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.446</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">FullRedisPool<span class="token punctuation">.</span>Init</span> <span class="token class-name">NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>RedisClient</span> Min<span class="token operator">=</span><span class="token number">2</span> Max<span class="token operator">=</span><span class="token number">1000</span> IdleTime<span class="token operator">=</span><span class="token number">20</span>s AllIdleTime<span class="token operator">=</span><span class="token number">120</span>s
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.446</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">FullRedisPool<span class="token punctuation">.</span>Acquire</span> <span class="token class-name">Create</span> Free<span class="token operator">=</span><span class="token number">0</span> Busy<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.447</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">DBSIZE</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.449</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">5</span>
共有缓存对象 <span class="token number">5</span> 个
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.456</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SET</span> name 大石头
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.458</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token class-name">OK</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.459</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">GET</span> name
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.463</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> 大石头
大石头
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.467</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SETEX</span> time <span class="token number">1</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.470</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token class-name">OK</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.472</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">GET</span> time
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33.474</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">33</span>
<span class="token number">22</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">34.584</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">GET</span> time
<span class="token number">0001</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>
</code></pre></div><ul><li>Set方法第一个参数是key；第二个参数是value，可以是任意类型；第三个是过期时间,单位是秒</li></ul> <blockquote><p>字符串和字节数组是特殊处理，原封不动传到Redis保存。其它复杂类型默认进行Json序列化，传过去的是Json。所以取回来的时候根据类型处理，字符串或字节数据原样返回，其它复杂类型进行Json反序列化处理。
Set命令一定一定要指定过期时间，不然一直留在内存里很麻烦，宁愿过期后重新写入也不要让它一直留在数据库。</p></blockquote> <h4 id="保存对象"><a href="#保存对象" aria-hidden="true" class="header-anchor">#</a> 保存对象</h4> <p>执行</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            XTrace<span class="token punctuation">.</span><span class="token function">UseConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 激活FullRedis，否则Redis.Create会得到默认的Redis对象</span>
            FullRedis<span class="token punctuation">.</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">Test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            Console<span class="token punctuation">.</span><span class="token function">ReadKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">class</span> <span class="token class-name">User</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">String</span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">public</span> <span class="token class-name">DateTime</span> CreateTime <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Test5</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;NewLife&quot;</span><span class="token punctuation">,</span> CreateTime <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> rds <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rds<span class="token punctuation">.</span>Log <span class="token operator">=</span> XTrace<span class="token punctuation">.</span>Log<span class="token punctuation">;</span>
            rds<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> user<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> user2 <span class="token operator">=</span> rds<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Json: {0}&quot;</span><span class="token punctuation">,</span> user2<span class="token punctuation">.</span><span class="token function">ToJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;Json: {0}&quot;</span><span class="token punctuation">,</span> rds<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rds<span class="token punctuation">.</span><span class="token function">ContainsKey</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;存在！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rds<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>输出</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.447</span>  <span class="token number">1</span> N <span class="token operator">-</span> 为NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>Redis自动注册<span class="token class-name">NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>FullRedis</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.531</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SELECT</span> <span class="token number">2</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.534</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token class-name">OK</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.536</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">FullRedisPool<span class="token punctuation">.</span>Init</span> <span class="token class-name">NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>RedisClient</span> Min<span class="token operator">=</span><span class="token number">2</span> Max<span class="token operator">=</span><span class="token number">1000</span> IdleTime<span class="token operator">=</span><span class="token number">20</span>s AllIdleTime<span class="token operator">=</span><span class="token number">120</span>s
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.536</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">FullRedisPool<span class="token punctuation">.</span>Acquire</span> <span class="token class-name">Create</span> Free<span class="token operator">=</span><span class="token number">0</span> Busy<span class="token operator">=</span><span class="token number">1</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.540</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SETEX</span> user <span class="token number">3600</span> <span class="token punctuation">[</span><span class="token number">53</span><span class="token punctuation">]</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.544</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token class-name">OK</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.546</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">GET</span> user
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.550</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">53</span><span class="token punctuation">]</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.556</span>  <span class="token number">1</span> N <span class="token operator">-</span> Json<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NewLife&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;CreateTime&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2018-11-12 23:01:36&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.556</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">GET</span> user
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.559</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token number">53</span><span class="token punctuation">]</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.560</span>  <span class="token number">1</span> N <span class="token operator">-</span> Json<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;Name&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;NewLife&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;CreateTime&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;2018-11-12 23:01:36&quot;</span><span class="token punctuation">}</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.561</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">EXISTS</span> user
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.563</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.564</span>  <span class="token number">1</span> N <span class="token operator">-</span> 存在！
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.565</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">DEL</span> user
<span class="token number">23</span><span class="token punctuation">:</span><span class="token number">01</span><span class="token punctuation">:</span><span class="token number">36.568</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
</code></pre></div><ul><li>保存复杂对象时，默认采用Json序列化，所以上面可以按字符串把结果取回来，发现正是Json字符串。Redis的strings，实质上就是带有长度前缀的二进制数据，[53]表示一段53字节长度的二进制数据。</li> <li>所以这个Set操作，在Redis那边对应的数据类型都是strings。</li></ul> <h4 id="列表list操作"><a href="#列表list操作" aria-hidden="true" class="header-anchor">#</a> 列表List操作</h4> <p>执行</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">// 列表</span>
<span class="token keyword">var</span> list <span class="token operator">=</span> ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetList</span><span class="token punctuation">&lt;</span><span class="token class-name">DateTime</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;list&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">RemoveAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>list<span class="token punctuation">.</span>Count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.571</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">RPUSH</span> list <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.576</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">5</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.613</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">RPUSH</span> list <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.618</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">6</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.619</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LINDEX</span> list <span class="token number">1</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.623</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.624</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LREM</span> list <span class="token number">1</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">12</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.628</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.634</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LLEN</span> list
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.645</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">5</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.646</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LINDEX</span> list <span class="token number">4</span>
<span class="token number">16</span><span class="token punctuation">:</span><span class="token number">09</span><span class="token punctuation">:</span><span class="token number">44.651</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span>
</code></pre></div><ul><li>通过<code>GetList</code>返回一个<code>IList</code>结构，这一操作没有向Redis发送命令，只有<code>Add</code>、<code>Remove</code>或者计算<code>Count</code>的时候会向Redis发送命令</li> <li><blockquote><p><strong>用途</strong>，举个物联网的栗子：物联网设备源源不断上传数据，如果每次上传数据都写入数据，数据库可能会受不了的，怎么办？这时候就可以把每一条数据放到Redis，放到上面说的List里面，凑到一定程度，然后整批拿出来。比如一分钟来了一万行数据，从Redis里面拿出来，再来个批操作把这些数据一次写入数据库。这个功能XCode有实现，如何提升批操作性能？后面XCode教程会讲。</p></blockquote></li> <li><blockquote><p><strong>技巧</strong>，key构建：根据自己的数据构造，比如一分钟或者十分钟插入一次，以这个时间为单位，用一个前缀，加上年月日时分作为一个key，新的数据写入新的key。这样在数据写入数据库的时候，新的数据写入新的key，两边都不影响。在数据都写入数据库之后，再通过这个key干掉这一万数据。</p></blockquote></li></ul> <h4 id="字典操作"><a href="#字典操作" aria-hidden="true" class="header-anchor">#</a> 字典操作</h4> <p>执行</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> dic <span class="token operator">=</span> ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetDictionary</span><span class="token punctuation">&lt;</span><span class="token class-name">DateTime</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;dic&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
dic<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">,</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>dic<span class="token punctuation">[</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToFullString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.526</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">HSET</span> dic xxx <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.578</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.639</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">HGET</span> dic xxx
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.664</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42</span>
<span class="token number">2018</span><span class="token operator">-</span><span class="token number">11</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42</span>
</code></pre></div><ul><li><code>GetDictionary</code>方法也是返回<code>IDictionary</code>接口类型变量，此类型适合存对象，比如用户对象，有很多个属性。相比存json，它的优势是按需读取。当对象的属性特别多时，优势更加明显。</li></ul> <h4 id="队列操作"><a href="#队列操作" aria-hidden="true" class="header-anchor">#</a> 队列操作</h4> <p>执行</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> mq <span class="token operator">=</span> ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetQueue</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
mq<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;g&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;e&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;m&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> mq<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.710</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">RPUSH</span> queue abc g e m
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.781</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">9</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">42.917</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LPOP</span> queue
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.096</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> abc
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.101</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LPOP</span> queue
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.105</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> g
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.106</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">LPOP</span> queue
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.118</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> e
abc<span class="token punctuation">,</span>g<span class="token punctuation">,</span>e
</code></pre></div><ul><li>队列其实也是List实现的，这里做了个优化，可以添加一批。示例加了一批数据，也拿了一批。</li> <li><blockquote><p>一个使用场景是消峰、错峰。上下游系统中，上游数据量突然爆发，下游一时处理不了，最简单的方案就是就Redis队列。上游往队列推数据，下游慢慢消费、处理数据。</p></blockquote></li> <li><blockquote><p>另一个变态的用途，是可以用来实现跨语言网络通信。所有语言都支持Redis，使用队列，一个接收数据放入队列一个消费数据写入数据库等。比如前面使用go语言，消耗内存少，接收消息推进队列；后面使用C#或者Java从队列拿出来处理业务，写入数据库。这样就实现了跨语言的高效通信，效率极高。此功能虽然没实践过，不过挺好用，有需要的可以试下。</p></blockquote></li></ul> <h4 id="集合操作"><a href="#集合操作" aria-hidden="true" class="header-anchor">#</a> 集合操作</h4> <p>执行</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> <span class="token keyword">set</span> <span class="token operator">=</span> ic<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetSet</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;181110_1234&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;xx1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;xx2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;xx3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">.</span>Count<span class="token punctuation">)</span><span class="token punctuation">;</span>
Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">&quot;xx2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.129</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SADD</span> <span class="token number">181110</span>_1234 xx1
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.134</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.140</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SADD</span> <span class="token number">181110</span>_1234 xx2
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.150</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.166</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SADD</span> <span class="token number">181110</span>_1234 xx3
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.185</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">0</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.191</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SCARD</span> <span class="token number">181110</span>_1234
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.198</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">3</span>
<span class="token number">3</span>
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.249</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token class-name">SISMEMBER</span> <span class="token number">181110</span>_1234 xx2
<span class="token number">17</span><span class="token punctuation">:</span><span class="token number">03</span><span class="token punctuation">:</span><span class="token number">43.254</span>  <span class="token number">1</span> N <span class="token operator">-</span> <span class="token operator">=&gt;</span> <span class="token number">1</span>
True
</code></pre></div><ul><li>集合也比较常用，它其实是个Set结构，往里面添加数据，然后判断下是否包含。所以集合比较合适精确判断的<strong>去重</strong>功能的场景。比如业务上有几千万订单一天，订单号可能会重复，想要统计一下今天一共有多少订单，如果在数据库执行<code>GroupBy</code>分组不太方便，所以业务统计可以用这个Set结构去重，实际使用可能还要更复杂一点。一般我们做五千万级别的去重，所占内存也不少，也就是写入五千万个订单号，后面处理的时候判断一下这个订单号处理过没有。</li> <li><blockquote><p>**实战经验：**有一个功能是快递揽收，就是商家发货了，快递网点要把它收回来，但是收回来之前，网点不知道它有多少货。所以做一个功能，商家发货了就把订单号发到快递公司，以时间和网点编号为key，比如key为上面的<code>181110_1234</code>。也就是编号为<code>1234</code>的网点在<code>18-11-10</code>这天快递公司收到所有的订单都放在这个key里面，然后利用Set结构的去重功能，写过一次的订单不会再次添加，所以订单重复提交都没有问题。这是第一个功能，第二个功能是，网点揽收之后，再告诉快递公司这个单被揽收了，这时候把这个订单从<code>181110_1234</code>这个key里面删掉，最后Set里面剩下的订单，就是<code>18-11-10</code>这天<code>1234</code>网点未揽收订单。</p></blockquote></li> <li><blockquote><p>另外，如果网点太多，订单太多，可以用网点id做个哈希，再分摊到32甚至64台Redis上，这样不管多少网点多少订单都可以把数据摊开。</p></blockquote></li> <li><blockquote><p>Redis还有个类型<a href="https://github.com/antirez/redis-doc/blob/master/topics/data-types-intro.md#hyperloglogs" target="_blank" rel="noopener noreferrer">HyperLogLogs<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>可以去重，能达到百亿级别，但是有一定几率误判。还有一个去重过滤的是<a href="https://baike.baidu.com/item/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8/5384697" target="_blank" rel="noopener noreferrer">布隆过滤器（Bloom Filter）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，可用于爬虫url去重等。</p></blockquote></li></ul> <h4 id="批量操作"><a href="#批量操作" aria-hidden="true" class="header-anchor">#</a> 批量操作</h4> <p>执行：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> dic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dictionary</span><span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">&gt;</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;NewLife&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;time&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1234</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
rds<span class="token punctuation">.</span><span class="token function">SetAll</span><span class="token punctuation">(</span>dic<span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> vs <span class="token operator">=</span> rds<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetAll</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>dic<span class="token punctuation">.</span>Keys<span class="token punctuation">)</span><span class="token punctuation">;</span>
XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>vs<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> e <span class="token operator">=&gt;</span> $<span class="token string">&quot;{e.Key}={e.Value}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>结果：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">MSET</span> name <span class="token class-name">NewLife</span> time <span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token number">26</span> count <span class="token number">1234</span>
<span class="token operator">=&gt;</span> <span class="token class-name">OK</span>
<span class="token class-name">EXPIRE</span> name <span class="token number">120</span>
<span class="token class-name">EXPIRE</span> time <span class="token number">120</span>
<span class="token class-name">EXPIRE</span> count <span class="token number">120</span>
<span class="token class-name">MGET</span> name time count
name<span class="token operator">=</span>NewLife<span class="token punctuation">,</span>time<span class="token operator">=</span><span class="token number">2018</span><span class="token operator">-</span><span class="token number">09</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">56</span><span class="token punctuation">:</span><span class="token number">26</span><span class="token punctuation">,</span>count<span class="token operator">=</span><span class="token number">1234</span>
</code></pre></div><ul><li>GetAll/SetAll 在Redis上是很常用的批量操作，同时获取或设置多个key，一般有10倍以上吞吐量。</li> <li>一次GetAll的时间大概是一次Get的一点几倍，一般建议如果需要两次以上的Get操作，直接用GetAll。</li></ul> <h3 id="高级操作"><a href="#高级操作" aria-hidden="true" class="header-anchor">#</a> 高级操作</h3> <ul><li>Add 添加，当key不存在时添加，已存在时返回false。</li> <li>Replace 替换，替换已有值为新值，返回旧值。</li> <li>Increment 累加，原子操作</li> <li>Decrement 递减，原子操作</li> <li><blockquote><p>Add跟Replace就是实现Redis分布式锁的关键，分布式锁源码：https://github.com/NewLifeX/X/blob/master/NewLife.Core/Caching/CacheLock.cs</p></blockquote></li></ul> <p>执行：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> flag <span class="token operator">=</span> rds<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">5678</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>flag <span class="token punctuation">?</span> <span class="token string">&quot;Add成功&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Add失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ori <span class="token operator">=</span> rds<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> count <span class="token operator">=</span> rds<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Get</span><span class="token punctuation">&lt;</span><span class="token class-name">Int32</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;count由{0}替换为{1}&quot;</span><span class="token punctuation">,</span> ori<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>

rds<span class="token punctuation">.</span><span class="token function">Increment</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> count2 <span class="token operator">=</span> rds<span class="token punctuation">.</span><span class="token function">Decrement</span><span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
XTrace<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">&quot;count={0}&quot;</span><span class="token punctuation">,</span> count2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>结果：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name">SETNX</span> count <span class="token number">5678</span>
<span class="token operator">=&gt;</span> <span class="token number">0</span>
Add失败
<span class="token class-name">GETSET</span> count <span class="token number">777</span>
<span class="token operator">=&gt;</span> <span class="token number">1234</span>
<span class="token class-name">GET</span> count
<span class="token operator">=&gt;</span> <span class="token number">777</span>
count由<span class="token number">1234</span>替换为<span class="token number">777</span>
<span class="token class-name">INCRBY</span> count <span class="token number">11</span>
<span class="token operator">=&gt;</span> <span class="token number">788</span>
<span class="token class-name">DECRBY</span> count <span class="token number">10</span>
<span class="token operator">=&gt;</span> <span class="token number">778</span>
count<span class="token operator">=</span><span class="token number">778</span>
</code></pre></div><h3 id="性能测试"><a href="#性能测试" aria-hidden="true" class="header-anchor">#</a> 性能测试</h3> <p>执行：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">var</span> ic <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1:6379&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//var ic = new MemoryCache();</span>
ic<span class="token punctuation">.</span><span class="token function">Bench</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出：</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">56.509</span>  <span class="token number">1</span> N <span class="token operator">-</span> 为NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>Redis自动注册<span class="token class-name">NewLife<span class="token punctuation">.</span>Caching<span class="token punctuation">.</span>FullRedis</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">56.512</span>  <span class="token number">1</span> N <span class="token operator">-</span> 目标服务器：<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">:</span><span class="token number">6379</span><span class="token operator">/</span><span class="token number">5</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">56.514</span>  <span class="token number">1</span> N <span class="token operator">-</span> FullRedis性能测试<span class="token punctuation">[</span>随机<span class="token punctuation">]</span>，批大小<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span>，逻辑处理器 <span class="token number">4</span> 个 <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">192</span>MHz<span class="token operator">-</span><span class="token function">Intel</span><span class="token punctuation">(</span>R<span class="token punctuation">)</span> <span class="token function">Core</span><span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i5<span class="token operator">-</span><span class="token number">6500</span> CPU @ <span class="token number">3.20</span>GHz
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">56.515</span>  <span class="token number">1</span> N <span class="token operator">-</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">56.515</span>  <span class="token number">1</span> N <span class="token operator">-</span> 测试 <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">1</span> 线程
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">57.063</span>  <span class="token number">1</span> N <span class="token operator">-</span> 赋值 <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">1</span> 线程，耗时     <span class="token number">457</span>ms 速度   <span class="token number">218</span><span class="token punctuation">,</span><span class="token number">818</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">58.227</span>  <span class="token number">1</span> N <span class="token operator">-</span> 读取 <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">1</span> 线程，耗时   <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">162</span>ms 速度    <span class="token number">86</span><span class="token punctuation">,</span><span class="token number">058</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">58.854</span>  <span class="token number">1</span> N <span class="token operator">-</span> 删除 <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">1</span> 线程，耗时     <span class="token number">625</span>ms 速度   <span class="token number">160</span><span class="token punctuation">,</span><span class="token number">000</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">59.518</span>  <span class="token number">1</span> N <span class="token operator">-</span> 累加 <span class="token number">100</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">1</span> 线程，耗时     <span class="token number">662</span>ms 速度   <span class="token number">151</span><span class="token punctuation">,</span><span class="token number">057</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">59.529</span>  <span class="token number">1</span> N <span class="token operator">-</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">39</span><span class="token punctuation">:</span><span class="token number">59.536</span>  <span class="token number">1</span> N <span class="token operator">-</span> 测试 <span class="token number">200</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">2</span> 线程
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">00.407</span>  <span class="token number">1</span> N <span class="token operator">-</span> 赋值 <span class="token number">200</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">2</span> 线程，耗时     <span class="token number">829</span>ms 速度   <span class="token number">241</span><span class="token punctuation">,</span><span class="token number">254</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">02.110</span>  <span class="token number">1</span> N <span class="token operator">-</span> 读取 <span class="token number">200</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">2</span> 线程，耗时   <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">688</span>ms 速度   <span class="token number">118</span><span class="token punctuation">,</span><span class="token number">483</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">03.244</span>  <span class="token number">1</span> N <span class="token operator">-</span> 删除 <span class="token number">200</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">2</span> 线程，耗时   <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">133</span>ms 速度   <span class="token number">176</span><span class="token punctuation">,</span><span class="token number">522</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">04.502</span>  <span class="token number">1</span> N <span class="token operator">-</span> 累加 <span class="token number">200</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">2</span> 线程，耗时   <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">256</span>ms 速度   <span class="token number">159</span><span class="token punctuation">,</span><span class="token number">235</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">04.502</span>  <span class="token number">1</span> N <span class="token operator">-</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">04.502</span>  <span class="token number">1</span> N <span class="token operator">-</span> 测试 <span class="token number">800</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">8</span> 线程
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">07.641</span>  <span class="token number">1</span> N <span class="token operator">-</span> 赋值 <span class="token number">800</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">8</span> 线程，耗时   <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">132</span>ms 速度   <span class="token number">255</span><span class="token punctuation">,</span><span class="token number">427</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">13.937</span>  <span class="token number">1</span> N <span class="token operator">-</span> 读取 <span class="token number">800</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">8</span> 线程，耗时   <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">282</span>ms 速度   <span class="token number">127</span><span class="token punctuation">,</span><span class="token number">347</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">18.735</span>  <span class="token number">1</span> N <span class="token operator">-</span> 删除 <span class="token number">800</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">8</span> 线程，耗时   <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">796</span>ms 速度   <span class="token number">166</span><span class="token punctuation">,</span><span class="token number">805</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">23.519</span>  <span class="token number">1</span> N <span class="token operator">-</span> 累加 <span class="token number">800</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">8</span> 线程，耗时   <span class="token number">4</span><span class="token punctuation">,</span><span class="token number">782</span>ms 速度   <span class="token number">167</span><span class="token punctuation">,</span><span class="token number">294</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">23.523</span>  <span class="token number">1</span> N <span class="token operator">-</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">23.523</span>  <span class="token number">1</span> N <span class="token operator">-</span> 测试 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">4</span> 线程
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">24.999</span>  <span class="token number">1</span> N <span class="token operator">-</span> 赋值 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">4</span> 线程，耗时   <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">466</span>ms 速度   <span class="token number">272</span><span class="token punctuation">,</span><span class="token number">851</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">28.035</span>  <span class="token number">1</span> N <span class="token operator">-</span> 读取 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">4</span> 线程，耗时   <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">019</span>ms 速度   <span class="token number">132</span><span class="token punctuation">,</span><span class="token number">494</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">30.318</span>  <span class="token number">1</span> N <span class="token operator">-</span> 删除 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">4</span> 线程，耗时   <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">282</span>ms 速度   <span class="token number">175</span><span class="token punctuation">,</span><span class="token number">284</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">32.694</span>  <span class="token number">1</span> N <span class="token operator">-</span> 累加 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项，  <span class="token number">4</span> 线程，耗时   <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">375</span>ms 速度   <span class="token number">168</span><span class="token punctuation">,</span><span class="token number">421</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">32.695</span>  <span class="token number">1</span> N <span class="token operator">-</span>
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">32.695</span>  <span class="token number">1</span> N <span class="token operator">-</span> 测试 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项， <span class="token number">64</span> 线程
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">34.342</span>  <span class="token number">1</span> N <span class="token operator">-</span> 赋值 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项， <span class="token number">64</span> 线程，耗时   <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">639</span>ms 速度   <span class="token number">244</span><span class="token punctuation">,</span><span class="token number">051</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">37.460</span>  <span class="token number">1</span> N <span class="token operator">-</span> 读取 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项， <span class="token number">64</span> 线程，耗时   <span class="token number">3</span><span class="token punctuation">,</span><span class="token number">106</span>ms 速度   <span class="token number">128</span><span class="token punctuation">,</span><span class="token number">783</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">40.201</span>  <span class="token number">1</span> N <span class="token operator">-</span> 删除 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项， <span class="token number">64</span> 线程，耗时   <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">739</span>ms 速度   <span class="token number">146</span><span class="token punctuation">,</span><span class="token number">038</span> ops
<span class="token number">10</span><span class="token punctuation">:</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">42.737</span>  <span class="token number">1</span> N <span class="token operator">-</span> 累加 <span class="token number">400</span><span class="token punctuation">,</span><span class="token number">000</span> 项， <span class="token number">64</span> 线程，耗时   <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">535</span>ms 速度   <span class="token number">157</span><span class="token punctuation">,</span><span class="token number">790</span> ops
</code></pre></div><ul><li>测试性能和机器配置有关，Bench方法用不同线程数量分多组进行添删改压力测试，</li> <li>rand参数设置是否随机读写</li> <li>batch设置批大小，分批执行操作，借助GetAll/SetAll进行优化</li> <li>管道，<code>StartPipeline</code>方法开启管道，<code>StopPipeline</code>结束管道，<code>Commit</code>方法提交变更，发送那两个方法中间的所有进入管道的命令。可用<code>AutoPipeline</code>属性，设置自动管道，默认设置100，达到设置值自动提交，无分批时打开管道操作，对添删改优化。</li></ul> <h2 id="经验技巧总结"><a href="#经验技巧总结" aria-hidden="true" class="header-anchor">#</a> 经验技巧总结</h2> <p>抄自源码的README：</p> <ul><li>在Linux上多实例部署，实例个数等于处理器个数，各实例最大内存直接为本机物理内存，避免单个实例内存撑爆</li> <li>把海量数据（10亿+）根据key哈希（Crc16/Crc32）存放在多个实例上，读写性能成倍增长</li> <li>采用二进制序列化，而非常见Json序列化</li> <li>合理设计每一对Key的Value大小，包括但不限于使用批量获取，原则是让每次网络包控制在1.4k字节附近，减少通信次数</li> <li>Redis客户端的Get/Set操作平均耗时200~600us（含往返网络通信），以此为参考评估网络环境和Redis客户端组件</li> <li>使用管道Pipeline合并一批命令</li> <li>Redis的主要性能瓶颈是序列化、网络带宽和内存大小，滥用时处理器也会达到瓶颈</li> <li>以上经验，源自于300多个实例4T以上空间一年多稳定工作的经验，并按照重要程度排了先后顺序，可根据场景需要酌情采用！</li></ul> <h3 id="redis的兄弟姐妹"><a href="#redis的兄弟姐妹" aria-hidden="true" class="header-anchor">#</a> Redis的兄弟姐妹</h3> <ul><li>Redis实现ICache接口，它的孪生兄弟MemoryCache，内存缓存，千万级吞吐率。各应用强烈建议使用ICache接口编码设计，小数据时使用MemoryCache实现；数据增大（10万）以后，改用Redis实现，不需要修改业务代码。</li></ul> <h2 id="写在最后"><a href="#写在最后" aria-hidden="true" class="header-anchor">#</a> 写在最后</h2> <ul><li>切不可道听途说，不可完全照搬，真假自己试一下就知道啦，试一下比什么都强！</li> <li>不常用功能没有封装，暂不支持集群，后面一定会支持。</li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/NewLifeX/XDoc/edit/master/articles/Redis/README.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">2018-11-16 07:38:10</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.9330de40.js" defer></script><script src="/assets/js/19.3ecaab5f.js" defer></script>
  </body>
</html>
